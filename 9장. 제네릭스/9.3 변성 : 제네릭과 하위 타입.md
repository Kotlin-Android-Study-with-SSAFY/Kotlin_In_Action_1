# Kotlin In Action ğŸ“– - Chapter 9.3: Variance (ë³€ì„±) and Generic Type Hierarchies

# âœ¨ 9.3 Variance: ì œë„¤ë¦­ê³¼ í•˜ìœ„ íƒ€ì…

**Variance(ë³€ì„±)** ì€ ì„œë¡œ ë‹¤ë¥¸ íƒ€ì… ì¸ìê°€ ìˆì„ ë•Œ, íƒ€ì… ê°„ì˜ í•˜ìœ„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ì„¤ì •í• ì§€ ì„¤ëª…í•˜ëŠ” ê°œë…ì´ë‹¤.

**í•µì‹¬ ê°œë…**
- ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì„ ê°€ì§„ ì œë„¤ë¦­ íƒ€ì… ê°„ ê´€ê³„ë¥¼ ê²°ì •í•œë‹¤.
- ë³€ì„±ì„ ì˜¬ë°”ë¥´ê²Œ ì§€ì •í•˜ë©´ API ì‚¬ìš© ì‹œ **íƒ€ì… ì•ˆì „ì„±**ì„ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

> ğŸ§  **ë³€ì„±ì„ ì‰½ê²Œ ì´í•´í•˜ëŠ” ë¹„ìœ **
> - **ê³µë³€ì„±(out)**: ìƒì‚°ì. ê°’ì„ ë§Œë“¤ì–´ì„œ ë°–ìœ¼ë¡œ ë‚´ë³´ë‚¸ë‹¤. (ë°˜í™˜ë§Œ)
> - **ë°˜ê³µë³€ì„±(in)**: ì†Œë¹„ì. ê°’ì„ ë°›ì•„ì„œ ì²˜ë¦¬ë§Œ í•œë‹¤. (ì†Œë¹„ë§Œ)

---

# ğŸ“š 9.3.1 ë³€ì„±ì´ í•„ìš”í•œ ì´ìœ : ì¸ìë¥¼ í•¨ìˆ˜ì— ë„˜ê¸°ê¸°

```kotlin
fun printContents(list: List<Any>) {
    println(list.joinToString())
}
```
- `List<String>`ì„ `List<Any>`ë¡œ ë„˜ê¸°ëŠ” ê²ƒì€ **ì½ê¸°ë§Œ í•œë‹¤ë©´ ì•ˆì „**í•˜ë‹¤.

ì“°ê¸° ê°€ëŠ¥í•œ ê²½ìš° ì£¼ì˜:
```kotlin
fun addAnswer(list: MutableList<Any>) {
    list.add(42)
}
```
- `MutableList<String>`ì— `Int`ê°€ ì¶”ê°€ë˜ì–´ ëŸ°íƒ€ì„ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

> âœ”ï¸ ì½ê¸° ì „ìš©(List)ì€ íƒ€ì… ì•ˆì „ì„±ì´ ìœ ì§€ë˜ì§€ë§Œ, ë³€ê²½ ê°€ëŠ¥í•œ ë¦¬ìŠ¤íŠ¸(MutableList)ëŠ” ìœ„í—˜í•˜ë‹¤.

---

# ğŸ“š 9.3.2 í´ë˜ìŠ¤, íƒ€ì…, í•˜ìœ„ íƒ€ì…

- í´ë˜ìŠ¤(class): ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì„¤ê³„ë„.
- íƒ€ì…(type): ê°’ì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ì†ì„±.
- í•˜ìœ„ íƒ€ì…(subtype): ë‹¤ë¥¸ íƒ€ì…ì— í¬í•¨ë  ìˆ˜ ìˆëŠ” íƒ€ì….

**íƒ€ì… ê°„ ê´€ê³„ ì˜ˆì œ**
```kotlin
val n: Number = 42 // OK
val n: Number = "string" // ì˜¤ë¥˜
```

> ğŸ§  **íƒ€ì… ê°„ ê´€ê³„**: ì‘ì€ íƒ€ì…(Int)ì´ í° íƒ€ì…(Number)ì— ë‹´ê¸¸ ìˆ˜ ìˆë‹¤.

---

# ğŸ“š 9.3.3 ê³µë³€ì„± (Covariance): í•˜ìœ„ íƒ€ì… ê´€ê³„ ìœ ì§€

```kotlin
interface Producer<out T> {
    fun produce(): T
}
```
- `Producer<Cat>`ëŠ” `Producer<Animal>`ì˜ í•˜ìœ„ íƒ€ì…ì´ë‹¤.
- `out` í‚¤ì›Œë“œëŠ” íƒ€ì… ì¸ìë¥¼ ë°˜í™˜ ìœ„ì¹˜(ìƒì‚°ì ì—­í• )ë¡œ ì œí•œí•˜ì—¬ íƒ€ì… ì•ˆì „ì„±ì„ ìœ ì§€í•œë‹¤.

**Herd ì˜ˆì œ**
```kotlin
class Herd<out T : Animal> { ... }
```

> âœ”ï¸ ë°˜í™˜ íƒ€ì…ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©´ íƒ€ì… ê´€ê³„ë¥¼ ì•ˆì „í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

> ğŸ§  **ë¹„ìœ **: ìƒì‚°ìëŠ” ìƒí’ˆì„ ìƒì‚°ë§Œ í•œë‹¤. ì†Œë¹„ìì˜ ì…ë ¥ì€ ë°›ì§€ ì•ŠëŠ”ë‹¤.

---

# ğŸ“š 9.3.4 ë°˜ê³µë³€ì„± (Contravariance): ë°˜ëŒ€ ë°©í–¥ì˜ í•˜ìœ„ íƒ€ì… ê´€ê³„

```kotlin
interface Comparator<in T> {
    fun compare(e1: T, e2: T): Int
}
```
- `Comparator<Animal>`ì€ `Comparator<Cat>`ì˜ í•˜ìœ„ íƒ€ì…ì´ë‹¤.
- `in` í‚¤ì›Œë“œëŠ” íƒ€ì… ì¸ìë¥¼ ì†Œë¹„ ìœ„ì¹˜ë¡œ ì œí•œí•˜ì—¬ íƒ€ì… ê´€ê³„ë¥¼ ë°˜ì „ì‹œí‚¨ë‹¤.

> âœ”ï¸ ì†Œë¹„ ìœ„ì¹˜ì—ì„œëŠ” íƒ€ì… ê´€ê³„ê°€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì‘ë™í•œë‹¤ëŠ” ì ì— ì£¼ì˜!

> ğŸ§  **ë¹„ìœ **: ì†Œë¹„ìëŠ” ë‹¤ì–‘í•œ ìƒí’ˆì„ ë°›ì•„ë“¤ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

# ğŸ“š 9.3.5 ì‚¬ìš© ì§€ì  ë³€ì„± (Use-site Variance)

```kotlin
fun copyData(source: MutableList<out Any>, destination: MutableList<Any>)
```
- `source`ëŠ” ì½ê¸° ì „ìš©(`out`)
- `destination`ì€ ì“°ê¸° ê°€ëŠ¥

## â˜… í”„ë¡œì ì…˜ (Projection)
| í”„ë¡œì ì…˜ | íƒ€ì… í‘œì‹œ | ì„¤ëª… |
|:---|:---|:---|
| ê³µë³€ì„± | `out` | ë°˜í™˜ ì „ìš© íƒ€ì… |
| ë°˜ê³µë³€ì„± | `in` | ì†Œë¹„ ì „ìš© íƒ€ì… |

> âœ¨ ìë°”ëŠ” ì„ ì–¸ ì§€ì  ë³€ì„±ë§Œ ìˆì—ˆì§€ë§Œ, ì½”í‹€ë¦°ì€ ì‚¬ìš© ì§€ì  ë³€ì„±ë„ ì§€ì›í•œë‹¤.

---

# ğŸ“š 9.3.6 ìŠ¤íƒ€ í”„ë¡œì ì…˜ (Star Projection)

- íƒ€ì… ì¸ìë¥¼ ëª¨ë¥¼ ë•Œ `List<*>` í˜•íƒœë¡œ í‘œí˜„í•œë‹¤.

```kotlin
val unknownList: List<*> = listOf("Svetlana", "Dmitry")
```
- ì½ê¸°ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, íƒ€ì…ì„ ëª¨ë¥´ë¯€ë¡œ ì•ˆì „í•œ ì“°ê¸°ëŠ” ë¶ˆê°€ëŠ¥í•˜ë‹¤.

> ğŸ§  **ë¹„ìœ **: ëª¨ë¥´ëŠ” ë°•ìŠ¤ ì•ˆì˜ ë¬¼ê±´ì€ êº¼ë‚´ë³¼ ìˆ˜ ìˆì§€ë§Œ, ìƒˆë¡œìš´ ë¬¼ê±´ì„ ë„£ê¸°ëŠ” ìœ„í—˜í•˜ë‹¤.

---

# ğŸ”¹ ì…ë ¥ ê²€ì¦ ì˜ˆì œ: FieldValidator

```kotlin
interface FieldValidator<in T> {
    fun validate(input: T): Boolean
}

object DefaultStringValidator : FieldValidator<String> { ... }
object DefaultIntValidator : FieldValidator<Int> { ... }
```

**Validator ê°ì²´ ì‘ì„± ê°œìš”**
```kotlin
object Validators {
    fun <T: Any> registerValidator(kClass: KClass<T>, validator: FieldValidator<T>)
    operator fun <T: Any> get(kClass: KClass<T>): FieldValidator<T>
}
```

- íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥í•˜ëŠ” API.
- ì •í™•í•œ íƒ€ì… ë§¤ì¹­ì„ í†µí•´ ê²€ì¦ ë¡œì§ êµ¬í˜„.

---

# ğŸ”¹ 9.3 ì „ì²´ ìš”ì•½

| êµ¬ë¶„ | íƒ€ì… ì•ˆì „ì„± ìœ ì§€ | ì‚¬ìš© ìœ„ì¹˜ |
|:---|:---|:---|
| ê³µë³€ì„± | out | ë°˜í™˜ ì „ìš© ìœ„ì¹˜ |
| ë°˜ê³µë³€ì„± | in | ì†Œë¹„ ì „ìš© ìœ„ì¹˜ |
| ë¬´ê³µë³€ì„± | ì—†ìŒ | í•˜ìœ„ ê´€ê³„ ì—†ìŒ |

> âœ¨ ë³€ì„±ì„ ì˜¬ë°”ë¥´ê²Œ ì§€ì •í•˜ë©´ íƒ€ì…ì˜ ì•ˆì „ì„±ê³¼ ì½”ë“œ í’ˆì§ˆì´ ë†’ì•„ì§„ë‹¤!

> ğŸ§  **í•œ ì¤„ ì •ë¦¬**: "outì€ ìƒì‚°ì, inì€ ì†Œë¹„ì"ë¼ê³  ì™¸ìš°ì!

---

# ğŸ“… ì°¸ê³ ì‚¬í•­

- í´ë˜ìŠ¤ì— `out`, `in` í‘œê¸°ì™€ ì‚¬ìš© ì§€ì  ë³€ì„±(use-site variance) ë° ì„ ì–¸ ì§€ì  ë³€ì„±(declaration-site variance)ì˜ ì°¨ì´ ì´í•´ í•„ìš”
- `MutableList`, `FieldValidator`, `copyData` ì˜ˆì œëŠ” ì‹¤ì „ íƒ€ì… ì•ˆì „ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¢‹ì€ ì‚¬ë¡€ë‹¤.

---
